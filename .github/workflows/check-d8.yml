name: Check D8 Availability

on: workflow_dispatch  # This adds a "Run workflow" button in the Actions tab

jobs:
  verify-env:
    runs-on: ubuntu-latest

    steps:
      # GitHub Runners have Java, but explicit setup prevents version conflicts
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Find and Run D8
        run: |
          echo "üîç Searching for Android Build Tools..."
          
          # 1. Locate the directory
          BUILD_TOOLS_ROOT="$ANDROID_HOME/build-tools"
          
          # 2. Pick the latest version installed (sorts numerically)
          LATEST_VERSION=$(ls "$BUILD_TOOLS_ROOT" | sort -V | tail -n 1)
          D8_PATH="$BUILD_TOOLS_ROOT/$LATEST_VERSION/d8"
          
          echo "‚úÖ Found latest Build Tools: $LATEST_VERSION"
          echo "üìç D8 Path: $D8_PATH"
          
          # 3. Verify it runs
          echo "--------------------------------------"
          echo "üöÄ Attempting to run D8..."
          "$D8_PATH" --version
          echo "--------------------------------------"